<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile Resources Menu App</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.crowdin.com/apps/dist/iframe.js" defer></script>
    <script src="app.js" defer></script>
</head>
<body>
    <!-- Main Container -->
    <div class="container" role="main">
        <h1>üë§ Profile Resources Menu Demo</h1>
        
        <!-- Introduction Section -->
        <div class="tool-section">
            <h3>üöÄ Welcome to Crowdin Profile Resources Menu Template</h3>
            <p>This template demonstrates a fully functional Crowdin app with <strong>Profile Resources Menu</strong> module integration.</p>
            
            <div class="context-info">
                <strong>üìå About Profile Resources Menu:</strong><br>
                Profile Resources Menu apps appear in the user profile menu and provide user-specific functionality. They have access to user context and can store user preferences and settings.
            </div>
            
            <h4>What's Included in This Template:</h4>
            <ul class="feature-list">
                <li><strong>Crowdin Apps JS API</strong> - Official SDK integration with AP object</li>
                <li><strong>Express.js Backend</strong> - Server with Crowdin SDK (@crowdin/app-project-module)</li>
                <li><strong>JWT Authentication</strong> - Secure token-based authentication</li>
                <li><strong>User Context Access</strong> - Automatic user ID and organization ID</li>
                <li><strong>User Preferences</strong> - Load and save user-specific settings</li>
                <li><strong>TypeScript Support</strong> - Type-safe backend development</li>
            </ul>

            <div class="info-box">
                <strong>üí° Getting Started:</strong><br>
                1. Explore the sections below to see the app in action<br>
                2. Check <code>app.js</code> for frontend code<br>
                3. Review <code>worker/app.ts</code> for backend API endpoints<br>
                4. Customize the UI and add your business logic
            </div>
        </div>

        <!-- User Context Section -->
        <div class="tool-section" role="region" aria-labelledby="user-context-heading">
            <h3 id="user-context-heading">üìä Current User Context</h3>
            <p>This section displays information retrieved via <code>AP.getContext()</code></p>
            <div id="userInfo" class="loading" role="status" aria-live="polite">Loading user information...</div>
            
            <div class="code-snippet">
                <strong>Code Example:</strong><br>
                AP.getContext(function(context) {<br>
                &nbsp;&nbsp;console.log('User ID:', context.user_id);<br>
                &nbsp;&nbsp;console.log('Organization ID:', context.organization_id);<br>
                });
            </div>
        </div>

        <!-- User Preferences Section -->
        <div class="tool-section" role="region" aria-labelledby="preferences-heading">
            <h3 id="preferences-heading">‚öôÔ∏è User Preferences</h3>
            <p>User preferences stored in Crowdin Apps SDK metadata storage.</p>
            <p style="font-size: 0.95rem; color: #6c757d;">These preferences are automatically saved and loaded per user using <code>saveMetadata()</code> and <code>getMetadata()</code></p>
            
            <div id="preferencesInfo" class="loading" role="status" aria-live="polite">Loading preferences...</div>
            
            <!-- Edit Preferences Form -->
            <div id="editPreferencesForm" style="display: none; margin-top: 20px;">
                <h4>Edit Preferences:</h4>
                <div class="form-group">
                    <label for="themeSelect">Theme:</label>
                    <select id="themeSelect" class="form-control">
                        <option value="auto">Auto</option>
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="languageSelect">Language:</label>
                    <select id="languageSelect" class="form-control">
                        <option value="en">English</option>
                        <option value="uk">Ukrainian</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="notificationsCheck"> Enable Notifications
                    </label>
                </div>
                
                <div class="form-group">
                    <label for="emailDigestSelect">Email Digest:</label>
                    <select id="emailDigestSelect" class="form-control">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="never">Never</option>
                    </select>
                </div>
                
                <button onclick="savePreferences()" class="action-button">
                    üíæ Save Preferences
                </button>
            </div>
            
            <div class="code-snippet">
                <strong>Storage API Usage (worker/app.ts):</strong><br>
                const key = `org_${organizationId}_user_${userId}_preferences`;<br>
                // Save: await crowdinApp.saveMetadata(key, data, organizationId);<br>
                // Load: await crowdinApp.getMetadata(key);<br>
                // Delete: await crowdinApp.deleteMetadata(key);
            </div>
        </div>

        <!-- Actions Section -->
        <div class="tool-section" role="region" aria-labelledby="actions-heading">
            <h3 id="actions-heading">‚ö° User Actions</h3>
            <p>Example buttons that trigger backend API calls to <code>POST /api/user-action</code></p>
            
            <div style="margin: 20px 0;" role="group" aria-label="User actions">
                <button class="action-button" 
                        onclick="performAction('update-preferences')" 
                        aria-label="Update user preferences with timestamp">
                    üíæ Update Preferences
                </button>
                <button class="action-button" 
                        onclick="performAction('export-data')" 
                        aria-label="Export user data">
                    üì• Export My Data
                </button>
                <button class="action-button" 
                        onclick="performAction('clear-cache')" 
                        aria-label="Clear stored user preferences"
                        style="background: #dc3545;">
                    üóëÔ∏è Clear Stored Data
                </button>
            </div>
            
            <div id="actionResult" role="status" aria-live="polite"></div>
            
            <div class="code-snippet">
                <strong>Backend Code (worker/app.ts):</strong><br>
                case 'clear-cache':<br>
                &nbsp;&nbsp;const key = `org_${organizationId}_user_${userId}_preferences`;<br>
                &nbsp;&nbsp;await crowdinApp.deleteMetadata(key);<br>
                &nbsp;&nbsp;// This removes all stored user preferences<br>
                &nbsp;&nbsp;break;
            </div>
        </div>

        <!-- API Reference Section -->
        <div class="tool-section" role="region" aria-labelledby="api-reference-heading">
            <h3 id="api-reference-heading">üìö Available Crowdin Apps JS API Methods</h3>
            <table class="data-table" role="table" aria-label="Crowdin Apps JS API methods reference">
                <thead>
                    <tr>
                        <th>Method</th>
                        <th>Description</th>
                        <th>Usage</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>AP.getContext(callback)</code></td>
                        <td>Get user context information</td>
                        <td><span class="badge success">Used</span></td>
                    </tr>
                    <tr>
                        <td><code>AP.getJwtToken(callback)</code></td>
                        <td>Get JWT token for API calls</td>
                        <td><span class="badge success">Used</span></td>
                    </tr>
                    <tr>
                        <td><code>AP.redirect(path)</code></td>
                        <td>Navigate to different Crowdin page</td>
                        <td><span class="badge info">Available</span></td>
                    </tr>
                    <tr>
                        <td><code>AP.events.on(event, callback)</code></td>
                        <td>Listen to Crowdin events</td>
                        <td><span class="badge info">Available</span></td>
                    </tr>
                </tbody>
            </table>
            
            <p style="margin-top: 15px;">
                üìñ <strong>Full API Documentation:</strong> 
                <a href="https://support.crowdin.com/developer/crowdin-apps-js" target="_blank">
                    https://support.crowdin.com/developer/crowdin-apps-js
                </a>
            </p>
        </div>

        <!-- Implementation Guide -->
        <div class="tool-section">
            <h3>üîß Implementation Guide</h3>
            
            <h4>Frontend (app.js):</h4>
            <div class="code-snippet">
                ‚Ä¢ Use <code>AP.getContext()</code> to get user information<br>
                ‚Ä¢ Use <code>AP.getJwtToken()</code> to authenticate API calls<br>
                ‚Ä¢ Make requests to your backend endpoints with JWT token<br>
                ‚Ä¢ Update UI based on responses
            </div>

            <h4>Backend (worker/app.ts):</h4>
            <div class="code-snippet">
                ‚Ä¢ Initialize Crowdin SDK with <code>addCrowdinEndpoints()</code><br>
                ‚Ä¢ Use <code>establishCrowdinConnection(jwt)</code> to authenticate<br>
                ‚Ä¢ Access Crowdin API via <code>connection.client</code><br>
                ‚Ä¢ Return data to frontend via Express endpoints
            </div>

            <h4>Next Steps:</h4>
            <ul class="feature-list">
                <li>Update app configuration in <code>worker/app.ts</code> (name, identifier, description)</li>
                <li>Customize the UI in <code>index.html</code> and <code>styles.css</code></li>
                <li>Add your business logic in <code>app.js</code></li>
                <li>Create new API endpoints in <code>worker/app.ts</code></li>
                <li>Test your app in Crowdin user profile</li>
                <li>Deploy to Cloudflare Workers and install it in your Crowdin account</li>
            </ul>

            <div class="info-box">
                <strong>üéØ Pro Tips:</strong><br>
                ‚Ä¢ Profile Resources Menu apps are user-specific and can store preferences<br>
                ‚Ä¢ Use the Crowdin API efficiently - cache data when possible<br>
                ‚Ä¢ Handle errors gracefully and show user-friendly messages<br>
                ‚Ä¢ Test with different user roles and permissions
            </div>
        </div>

    </div>
</body>
</html>
